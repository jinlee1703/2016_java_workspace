package Project_Frame;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Font;
import java.awt.Graphics;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.text.DecimalFormat;

import javax.swing.BoxLayout;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.border.EmptyBorder;

import Project_DBInterface.DBInterface;

public class Chart extends JFrame {
	JLabel l1 = new JLabel();
	JLabel l2 = new JLabel();
	
	public Chart() {
		setTitle("수입 & 지출 차트 보기");
		setSize(600, 400);
		setLocationRelativeTo(null);
		
		JPanel p = new JPanel(new BorderLayout());
		
		ImagePanel p1 = new ImagePanel();
		JPanel p2 = new JPanel();
		p2.setBorder(new EmptyBorder(35, 0, 0, 0));
		p2.setLayout(new BoxLayout(p2, BoxLayout.Y_AXIS));
		p2.add(l1); p2.add(l2);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
		
		p.add(p1, BorderLayout.CENTER);
		p.add(p2, BorderLayout.EAST);
		p.setBorder(new EmptyBorder(15, 55, 15, 25));
		
		add(p);
		
		setDefaultCloseOperation(DISPOSE_ON_CLOSE);
		setVisible(true);
	}
	
	class ImagePanel extends JPanel {
		@Override
		protected void paintComponent(Graphics g) {
			// TODO Auto-generated method stub
			super.paintComponent(g);
			int a,b,sum;
			double sum1, sum2;
			
			try {
				ResultSet rs = DBInterface.Stmt.executeQuery("SELECT sum(amount) FROM project000.ledger where memberid='"+Login.id.getText()+"';");
				rs.next(); sum = rs.getInt(1);
				
				rs = DBInterface.Stmt.executeQuery("SELECT sum(amount) FROM project000.ledger where memberid='"+Login.id.getText()+"' and division='수입';");
				rs.next(); a = rs.getInt(1);
				
				rs = DBInterface.Stmt.executeQuery("SELECT sum(amount) FROM project000.ledger where memberid='"+Login.id.getText()+"' and division='지출';");
				rs.next(); b = rs.getInt(1);
				
				sum1 = (double) a / sum *100;
				sum2 = (double) b / sum *100;
				
				int ch1 = (int) Math.round(sum1*3.6);
				int ch2 = (int) Math.round(sum2*3.6);
				
				g.setColor(Color.blue);
				g.fillArc(0, 0, 330, 330, 0, ch1);
				
				g.setColor(Color.red);
				g.fillArc(0, 0, 330, 330, ch1, ch2);
				
				DecimalFormat df = new DecimalFormat("#.##");
				
				l1.setText("수입 : "+a+"원("+df.format(sum1)+"%)");
				l1.setFont(new Font("맑은 고딕", Font.PLAIN, 12));
				l1.setForeground(Color.blue);
				l2.setText("지출 : "+b+"원("+df.format(sum2)+"%)");
				l2.setFont(new Font("맑은 고딕", Font.PLAIN, 12));
				l2.setForeground(Color.red);
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
	}
}
